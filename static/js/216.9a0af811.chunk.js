"use strict";(self.webpackChunkflighttools=self.webpackChunkflighttools||[]).push([[216],{23:(e,t,n)=>{n.d(t,{e:()=>o});var a=n(215),l=n(996),r=n(576);var i=n(228);const o=(0,a.X3)((function(e,t){let{url:n,...a}=e;const o=new i.TileLayer(n,(0,l.P)(a,t));return(0,r.Q)(o,t)}),(function(e,t,n){!function(e,t,n){const{opacity:a,zIndex:l}=t;null!=a&&a!==n.opacity&&e.setOpacity(a),null!=l&&l!==n.zIndex&&e.setZIndex(l)}(e,t,n);const{url:a}=t;null!=a&&a!==n.url&&e.setUrl(a)}))},36:(e,t,n)=>{n.d(t,{p:()=>o});var a=n(215),l=n(576),r=n(772),i=n(228);const o=(0,a.Nq)((function(e,t){let{position:n,...a}=e;const o=new i.Marker(n,a);return(0,l.Q)(o,(0,r.W4)(t,{overlayContainer:o}))}),(function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}))},167:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var a=n(43),l=n(515),r=n(419),i=n(23),o=n(36),s=(n(433),n(228)),c=n.n(s),u=n(809),d=n(368),f=n(579);delete c().Icon.Default.prototype._getIconUrl,c().Icon.Default.mergeOptions({iconRetinaUrl:n(249),iconUrl:n(24),shadowUrl:n(71)});const g=(e,t,n)=>{var a;const l=Date.now(),r=t*((l-(null!==(a=e.timestamp)&&void 0!==a?a:l))/1e3)/3600,i=n*Math.PI/180,o=e.lat*Math.PI/180,s=e.lng*Math.PI/180,c=r/6371,u=Math.asin(Math.sin(o)*Math.cos(c)+Math.cos(o)*Math.sin(c)*Math.cos(i)),d=s+Math.atan2(Math.sin(i)*Math.sin(c)*Math.cos(o),Math.cos(c)-Math.sin(o)*Math.sin(u));return{lat:180*u/Math.PI,lng:180*d/Math.PI,timestamp:l,name:e.name}},h=(e,t,n,a)=>{const l=e*Math.PI/180,r=n*Math.PI/180,i=(n-e)*Math.PI/180,o=(a-t)*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(l)*Math.cos(r)*Math.sin(o/2)*Math.sin(o/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371e3*c)},m=e=>{let{center:t}=e;const n=(0,l.ko)();return(0,a.useEffect)((()=>{n.setView(t,n.getZoom())}),[t,n]),null},p=()=>{const{isDarkMode:e}=(0,d.D)(),[t,n]=(0,a.useState)(null),[l,s]=(0,a.useState)(null),[p,x]=(0,a.useState)([]),[v,b]=(0,a.useState)(!1),[w,y]=(0,a.useState)(null),[j,I]=(0,a.useState)(null),[N,M]=(0,a.useState)(""),[S,k]=(0,a.useState)(""),[C,E]=(0,a.useState)(!1),[$,A]=(0,a.useState)(""),[z,P]=(0,a.useState)(null),[D,O]=(0,a.useState)(null),[U,L]=(0,a.useState)(null),[_,R]=(0,a.useState)(null),[F,K]=(0,a.useState)(null),[B,q]=(0,a.useState)(null),[H,T]=(0,a.useState)(null),[W,Z]=(0,a.useState)(null),[Q,G]=(0,a.useState)(null);(0,a.useEffect)((()=>{t?localStorage.setItem("lastLocation",JSON.stringify(t)):localStorage.removeItem("lastLocation")}),[t]),(0,a.useEffect)((()=>()=>{U&&clearInterval(U),_&&clearInterval(_),F&&clearInterval(F),B&&clearInterval(B),H&&clearInterval(H)}),[U,_,F,B,H]),(0,a.useEffect)((()=>{if(t&&l){const e=h(t.lat,t.lng,l.lat,l.lng);y(e),I(e),B&&clearInterval(B),H&&clearInterval(H);const n=setInterval((()=>{if(t&&l){const e=h(t.lat,t.lng,l.lat,l.lng);y(e)}}),25);if(q(n),null!==z&&void 0!==z&&z.live&&D){const e=setInterval((()=>{if(z.live&&D&&!z.live.is_ground&&z.live.speed_horizontal>=50){const e=g(D,z.live.speed_horizontal,z.live.direction);s({lat:e.lat,lng:e.lng,name:`${z.airline.name} ${z.flight.number}`})}}),100);T(e)}}else y(null),I(null),B&&(clearInterval(B),q(null)),H&&(clearInterval(H),T(null))}),[t,l,z,D,g]),(0,a.useEffect)((()=>{if(null===w||null===j)return void I(w);const e=w-j;if(Math.abs(e)<1)return void I(w);const t=Math.sign(e)*Math.min(Math.abs(e),Math.max(1,Math.abs(e)/5)),n=setTimeout((()=>{I((e=>null!==e?e+t:null))}),16);return()=>clearTimeout(n)}),[w,j]);const V=async()=>{if(S.trim()){E(!0),M("");try{const e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(S)}`);if(!e.ok)throw new Error("Failed to fetch location");const t=await e.json();if(0===t.length)return M("Location not found"),void E(!1);const a={lat:parseFloat(t[0].lat),lng:parseFloat(t[0].lon),name:t[0].display_name};n(a),s(null)}catch(e){M("Error searching location: "+(e instanceof Error?e.message:"Unknown error"))}finally{E(!1)}}},X=(0,a.useCallback)((()=>{if(null!==z&&void 0!==z&&z.live&&D){if(z.live.is_ground||z.live.speed_horizontal<50)return console.log("Not interpolating - aircraft on ground or speed too low"),void Z(new Date);console.log("Calculating new position...");const e=g(D,z.live.speed_horizontal,z.live.direction);console.log(`New position: ${e.lat}, ${e.lng}`),e.name=`${z.flight.number}-${z.airline.name}`,O(e),s({lat:e.lat,lng:e.lng,name:e.name}),Z(new Date)}else console.log("Cannot interpolate - missing flight data or last position")}),[z,D,O,s,Z]),J=(0,a.useCallback)((()=>{console.log("Completely resetting all tracking state"),s(null),x([]),b(!1),P(null),O(null),y(null),I(null),G(null),Z(null),U&&(clearInterval(U),L(null)),_&&(clearInterval(_),R(null)),F&&(clearInterval(F),K(null)),B&&(clearInterval(B),q(null)),H&&(clearInterval(H),T(null)),sessionStorage.removeItem("lastApiCall")}),[]),Y=async function(){if($.trim()){J(),E(!0),M("");try{var e;$.padEnd(8," ");const t=await fetch("https://opensky-network.org/api/states/all?time=0&icao24=&callback=");if(!t.ok)throw new Error("Failed to fetch flight data");const n=await t.json();if(!n.states||0===n.states.length)throw new Error("No flight data found");const a=n.states.find((e=>e[1]&&e[1].trim().includes($.toUpperCase())));if(!a)throw new Error("Flight not found in tracking data");a[0];const l=null===(e=a[1])||void 0===e?void 0:e.trim(),r=(a[2],a[5]),i=a[6],o=a[7],c=a[8],u=a[9],d=a[10],f=a[11],g={flight:{number:$,iata:$},departure:{airport:"N/A",timezone:""},arrival:{airport:"N/A",timezone:""},airline:{name:l||$},live:{latitude:i,longitude:r,altitude:o||0,direction:d||0,speed_horizontal:u?3.6*u:0,speed_vertical:f||0,is_ground:Boolean(c),updated:(new Date).toISOString()}};G(Date.now()),sessionStorage.setItem("lastApiCall",Date.now().toString()),P(g);const h={lat:g.live.latitude,lng:g.live.longitude,name:`${g.airline.name} ${g.flight.number}`,timestamp:Date.now()};O(h),s({lat:h.lat,lng:h.lng,name:h.name})}catch(t){M("Error tracking flight: "+(t instanceof Error?t.message:"Unknown error")),J()}finally{E(!1)}}else M("Please enter a flight number")},ee=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(J(),E(!0),M(""));try{b(!0);const e=await fetch("https://opensky-network.org/api/states/all?time=0&callback=");if(!e.ok)throw new Error("Failed to fetch aircraft data");const t=await e.json();if(!t.states||0===t.states.length)throw new Error("No aircraft data found");const a=t.states.filter((e=>e[5]&&e[6]&&!isNaN(e[5])&&!isNaN(e[6])&&!e[8])).map((e=>{var t;return{icao24:e[0],callsign:null===(t=e[1])||void 0===t?void 0:t.trim(),latitude:e[6],longitude:e[5],altitude:e[7]||0,direction:e[10]||0,speed:e[9]?3.6*e[9]:0,isOnGround:Boolean(e[8])}}));if(x(a),G(Date.now()),sessionStorage.setItem("lastApiCall",Date.now().toString()),a.length>0){const e=a[Math.floor(a.length/2)];n({lat:e.latitude,lng:e.longitude,name:"Map Center"})}}catch(e){M("Error fetching aircraft: "+(e instanceof Error?e.message:"Unknown error")),b(!1),J()}finally{E(!1)}};return(0,a.useEffect)((()=>{if(F&&(console.log("Clearing existing interpolation interval"),clearInterval(F),K(null)),z&&D&&!v){console.log("Initializing interpolation from fresh data"),X();const e=setInterval((()=>{console.log("Interpolation interval triggered"),X()}),5e3);K(e)}return()=>{F&&clearInterval(F)}}),[z,D,v,X]),(0,a.useEffect)((()=>{if(_&&(console.log("Clearing existing auto-refresh interval before setting up a new one"),clearInterval(_),R(null)),z&&$||v){console.log("Setting up auto-refresh interval for flight data");const e=setInterval((()=>{console.log("Auto-refreshing flight data from API"),v?ee(!0):Y(!0)}),6e4);R(e)}return()=>{_&&(console.log("Clearing auto-refresh interval"),clearInterval(_))}}),[z,$,v,ee,Y]),(0,f.jsx)("div",{className:`min-h-screen ${e?"bg-gray-900":"bg-gray-100"} p-4`,children:(0,f.jsxs)("div",{className:(e?"bg-gray-800":"bg-white")+" rounded-lg shadow p-6 max-w-7xl mx-auto",children:[(0,f.jsxs)("div",{className:"mb-4 space-y-4",children:[(0,f.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,f.jsxs)("div",{className:"flex-1 min-w-[200px] flex gap-2",children:[(0,f.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),onKeyPress:e=>"Enter"===e.key&&V(),hidden:null!==t,placeholder:"Enter location (e.g., London, UK)",className:"flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")}),(0,f.jsx)("button",{onClick:V,disabled:C||!S.trim(),hidden:null!==t,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-blue-300 whitespace-nowrap",children:"Search"})]}),(0,f.jsxs)("div",{className:"flex-1 min-w-[200px] flex gap-2",children:[(0,f.jsx)("input",{type:"text",value:$,onChange:e=>A(e.target.value.toUpperCase()),onKeyPress:e=>"Enter"===e.key&&Y(),placeholder:"Enter flight number (e.g., BA123)",disabled:v,className:`flex-1 p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"} ${v?"opacity-50":""}`}),(0,f.jsx)("button",{onClick:e=>Y(),disabled:C||!$.trim()||v,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 disabled:bg-purple-300 whitespace-nowrap "+(v?"opacity-50":""),children:"Track Flight"}),(0,f.jsx)("button",{onClick:e=>ee(!1),disabled:C||v,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-green-300 whitespace-nowrap",children:"Track All"})]}),(0,f.jsxs)("div",{className:"flex gap-2",children:[(t||v)&&(0,f.jsx)("button",{onClick:()=>{n(null),k(""),M(""),A(""),J(),localStorage.removeItem("lastLocation")},disabled:C,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:bg-red-300 whitespace-nowrap",children:"Clear All"}),(z||v)&&(0,f.jsx)("button",{onClick:e=>{e.preventDefault(),v?ee(!1):Y(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 whitespace-nowrap",children:"Refresh"})]})]}),N&&(0,f.jsx)("div",{className:"p-3 rounded "+(e?"bg-red-900 text-red-100":"bg-red-100 text-red-700"),children:N}),z&&(0,f.jsxs)("div",{className:"p-4 rounded "+(e?"bg-blue-900 text-blue-100":"bg-blue-100 text-blue-700"),children:[(0,f.jsx)("div",{className:"flex justify-between items-center mb-3",children:(0,f.jsx)("div",{className:"font-medium text-lg",children:z.flight.number})}),null!==j&&(0,f.jsxs)("div",{className:"text-center",children:[(0,f.jsx)("div",{className:"text-sm font-medium mb-1 "+(e?"text-blue-200":"text-blue-800"),children:"Distance to Aircraft"}),(0,f.jsxs)("div",{className:"font-mono text-2xl font-bold",children:[Math.round(j).toLocaleString(),"m"]})]}),(0,f.jsxs)("div",{className:"space-y-3",children:[z.live&&(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm font-medium text-center "+(e?"text-blue-200":"text-blue-800"),children:"Altitude"}),(0,f.jsxs)("div",{className:"text-base text-center",children:[(ne=z.live.altitude,Math.round(3.28084*ne)),"ft"]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm font-medium text-center "+(e?"text-blue-200":"text-blue-800"),children:"Speed"}),(0,f.jsxs)("div",{className:"text-base text-center",children:[(te=z.live.speed_horizontal,Math.round(.539957*te)),"kts"]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm font-medium text-center "+(e?"text-blue-200":"text-blue-800"),children:"Direction"}),(0,f.jsxs)("div",{className:"text-base text-center",children:[z.live.direction,"\xb0"]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:"text-sm font-medium text-center "+(e?"text-blue-200":"text-blue-800"),children:"Status"}),(0,f.jsx)("div",{className:"text-base text-center",children:z.live.is_ground?"On Ground":"In Air"})]})]}),Q&&(0,f.jsxs)("div",{className:"text-xs mt-2 text-center "+(e?"text-blue-300":"text-blue-600"),children:["Using API data from ",new Date(Q).toLocaleString(),(0,f.jsx)("br",{}),(0,f.jsx)("span",{className:"italic",children:"Auto-refreshes every minute"})]})]})]}),v&&(0,f.jsxs)("div",{className:"p-4 rounded "+(e?"bg-green-900 text-green-100":"bg-green-100 text-green-700"),children:[(0,f.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,f.jsx)("div",{className:"font-medium text-lg",children:"All Aircraft"}),(0,f.jsxs)("div",{className:"text-sm font-mono",children:[p.length," aircraft"]})]}),(0,f.jsxs)("div",{className:"text-xs mt-2 text-center "+(e?"text-green-300":"text-green-600"),children:["Using API data from ",Q?new Date(Q).toLocaleString():"N/A",(0,f.jsx)("br",{}),(0,f.jsx)("span",{className:"italic",children:"Auto-refreshes every minute"})]})]})]}),(0,f.jsx)("div",{className:"h-[600px] rounded border "+(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:(0,f.jsxs)(r.W,{style:{height:"100%",width:"100%"},center:t?[t.lat,t.lng]:l?[l.lat,l.lng]:[51.505,-.09],zoom:t&&!v?13:l?10:6,scrollWheelZoom:!0,children:[(0,f.jsx)(i.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:e?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t&&(0,f.jsx)(o.p,{position:[t.lat,t.lng]}),l&&z&&!v&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.p,{position:[l.lat,l.lng],icon:c().divIcon({html:`<div style="transform: rotate(${z.live.direction||0}deg)">\n                      <img src="${u.A}" alt="plane" style="width: 24px; height: 24px;" />\n                    </div>`,className:"",iconSize:[24,24],iconAnchor:[12,12]})},`${z.flight.number}-${l.lat.toFixed(6)}-${l.lng.toFixed(6)}-${z.live.direction||0}-${Date.now()}`),(0,f.jsx)(m,{center:[l.lat,l.lng]})]}),v&&p.length>0&&p.map((e=>(0,f.jsx)(o.p,{position:[e.latitude,e.longitude],icon:c().divIcon({html:`<div style="transform: rotate(${e.direction}deg)">\n                    <img src="${u.A}" alt="plane" style="width: 16px; height: 16px;" />\n                  </div>`,className:"",iconSize:[16,16],iconAnchor:[8,8]})},`${e.icao24}-${e.latitude.toFixed(6)}-${e.longitude.toFixed(6)}`)))]})})]})});var te,ne}},215:(e,t,n)=>{n.d(t,{Nq:()=>f,Lt:()=>g,X3:()=>h});var a=n(43),l=(n(950),n(772));function r(e){function t(t,n){const{instance:r,context:i}=e(t).current;(0,a.useImperativeHandle)(n,(()=>r));const{children:o}=t;return null==o?null:a.createElement(l.dk,{value:i},o)}return(0,a.forwardRef)(t)}var i=n(576);function o(e,t){const n=(0,a.useRef)(void 0);(0,a.useEffect)((function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}}),[e,t])}var s=n(996);function c(e,t){(0,a.useEffect)((function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}}),[t,e])}function u(e){return function(t){const n=(0,l.U$)(),r=e((0,s.P)(t,n),n);return function(e,t){const n=(0,a.useRef)(t);(0,a.useEffect)((function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t}),[e,t])}(n.map,t.attribution),o(r.current,t.eventHandlers),c(r.current,n),r}}function d(e){return function(t){const n=(0,l.U$)(),r=e((0,s.P)(t,n),n);return o(r.current,t.eventHandlers),c(r.current,n),function(e,t){const n=(0,a.useRef)(void 0);(0,a.useEffect)((function(){if(t.pathOptions!==n.current){const a=t.pathOptions??{};e.instance.setStyle(a),n.current=a}}),[e,t])}(r.current,t),r}}function f(e,t){return r(u((0,i.K)(e,t)))}function g(e,t){return r(d((0,i.K)(e,t)))}function h(e,t){return function(e){function t(t,n){const{instance:l}=e(t).current;return(0,a.useImperativeHandle)(n,(()=>l)),null}return(0,a.forwardRef)(t)}(u((0,i.K)(e,t)))}},419:(e,t,n)=>{n.d(t,{W:()=>o});var a=n(772),l=n(228),r=n(43);function i(e,t){let{bounds:n,boundsOptions:i,center:o,children:s,className:c,id:u,placeholder:d,style:f,whenReady:g,zoom:h,...m}=e;const[p]=(0,r.useState)({className:c,id:u,style:f}),[x,v]=(0,r.useState)(null),b=(0,r.useRef)(void 0);(0,r.useImperativeHandle)(t,(()=>x?.map??null),[x]);const w=(0,r.useCallback)((e=>{if(null!==e&&!b.current){const t=new l.Map(e,m);b.current=t,null!=o&&null!=h?t.setView(o,h):null!=n&&t.fitBounds(n,i),null!=g&&t.whenReady(g),v((0,a.fB)(t))}}),[]);(0,r.useEffect)((()=>()=>{x?.map.remove()}),[x]);const y=x?r.createElement(a.dk,{value:x},s):d??null;return r.createElement("div",{...p,ref:w},y)}const o=(0,r.forwardRef)(i)},515:(e,t,n)=>{n.d(t,{Po:()=>i,ko:()=>r});var a=n(772),l=n(43);function r(){return(0,a.U$)().map}function i(e){const t=r();return(0,l.useEffect)((function(){return t.on(e),function(){t.off(e)}}),[t,e]),t}},576:(e,t,n)=>{n.d(t,{K:()=>r,Q:()=>l});var a=n(43);function l(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function r(e,t){return null==t?function(t,n){const l=(0,a.useRef)(void 0);return l.current||(l.current=e(t,n)),l}:function(n,l){const r=(0,a.useRef)(void 0);r.current||(r.current=e(n,l));const i=(0,a.useRef)(n),{instance:o}=r.current;return(0,a.useEffect)((function(){i.current!==n&&(t(o,n,i.current),i.current=n)}),[o,n,t]),r}}},772:(e,t,n)=>{n.d(t,{U$:()=>s,W4:()=>i,dk:()=>o,fB:()=>r});var a=n(43);const l=1;function r(e){return Object.freeze({__version:l,map:e})}function i(e,t){return Object.freeze({...e,...t})}const o=(0,a.createContext)(null);function s(){const e=(0,a.use)(o);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},809:(e,t,n)=>{n.d(t,{A:()=>a});n(43);const a=n.p+"static/media/plane-icon.5312c99550d9e701054eea554971757c.svg"},996:(e,t,n)=>{function a(e,t){const n=e.pane??t.pane;return n?{...e,pane:n}:e}n.d(t,{P:()=>a})}}]);
//# sourceMappingURL=216.9a0af811.chunk.js.map