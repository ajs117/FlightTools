"use strict";(self.webpackChunkflighttools=self.webpackChunkflighttools||[]).push([[52],{395:(e,t,r)=>{r.r(t),r.d(t,{default:()=>N});var a=r(43),s=r(424),n=r(292),l=r(515),o=r(419),i=r(23),c=r(30),d=r(36),u=(r(433),r(228)),g=r.n(u),h=r(909),m=r(193),p=r(299),x=r.n(p),f=r(809),b=r(368),y=r(579);const v=r(210);delete g().Icon.Default.prototype._getIconUrl,g().Icon.Default.mergeOptions({iconRetinaUrl:r(249),iconUrl:r(24),shadowUrl:r(71)});const j=e=>{let{waypoints:t}=e;const r=(0,l.ko)();return(0,a.useEffect)((()=>{if(t.length<2)return;const e=t.map((e=>g().latLng(e.lat,e.lon))),a=g().latLngBounds(e);r.fitBounds(a,{padding:[50,50]})}),[t,r]),null},w=e=>{let{currentTime:t}=e;const r=(0,l.ko)(),s=(0,a.useRef)(null);return(0,a.useEffect)((()=>(s.current=x()().addTo(r),()=>{s.current&&r.removeLayer(s.current)})),[r]),(0,a.useEffect)((()=>{s.current&&t&&s.current.setTime(t)}),[t]),null},N=()=>{const{isDarkMode:e}=(0,b.D)(),[t,r]=(0,a.useState)(""),[l,u]=(0,a.useState)(""),[p,x]=(0,a.useState)(!1),[N,C]=(0,a.useState)(""),[k,M]=(0,a.useState)([]),[T,S]=(0,a.useState)(""),[I,A]=(0,a.useState)(""),[D,O]=(0,a.useState)(null),[$,L]=(0,a.useState)(0),[F,P]=(0,a.useState)([]),U=(0,a.useCallback)((e=>{try{const t=v.getAirportByIcao(e);if(null===t||void 0===t||!t.iata)return null;return h.filter((e=>e.code===t.iata))[0]||null}catch(t){return null}}),[]),z=(0,a.useCallback)(((e,t,r,a)=>{const s=U(r),n=U(a);if(!s||!n)return"Unknown duration";const l=new Date(e),o=new Date(t),i=new Date(l.getTime()-36e5*s.offset.dst),c=new Date(o.getTime()-36e5*n.offset.dst).getTime()-i.getTime();return`${Math.floor(c/36e5)}h ${Math.round(c%36e5/6e4)}m`}),[U]),E=(0,a.useCallback)(((e,t,r,a)=>{if(e.length<2)return{position:[0,0],currentTime:new Date(r),percentage:0};const s=6e5,[n,l]=a.split("h ").map((e=>parseInt(e.replace("m","")))),o=36e5*n+6e4*l;let i=t;const c=s/o*100;if(t<=c)i=0;else if(t>=100-c)i=100;else{i=(t-c)/(100-2*c)*100}const d=e.length-1,u=i*d/100,g=Math.floor(u),h=u-g;let m;if(i>=100)m=[e[d].lat,e[d].lon];else if(i<=0)m=[e[0].lat,e[0].lon];else{const t=e[g],r=e[g+1];m=[t.lat+(r.lat-t.lat)*h,t.lon+(r.lon-t.lon)*h]}const p=new Date(r),x=o*t/100;return{position:m,currentTime:new Date(p.getTime()+x),percentage:t}}),[]),R=(0,a.useCallback)(((e,t)=>{if(!e.duration||!e.route.nodes.length)return void P([]);const r=[],a=3e5,[s,n]=e.duration.split("h ").map((e=>parseInt(e.replace("m","")))),l=36e5*s+6e4*n+12e5,o=Math.ceil(l/a);for(let i=0;i<=o;i++){const s=i*a*100/l;if(s>100)break;const n=E(e.route.nodes,s,t,e.duration);r.push({...n,timeString:n.currentTime.toLocaleTimeString()})}P(r),L(0),O(r[0]||null)}),[E]),B=(0,a.useCallback)(((e,t)=>{const r="number"===typeof t?t:t[0];if(L(r),0===F.length)return;const a=((e,t)=>{if(!e.length)return null;let r=0,a=e.length-1;if(t<=e[0].percentage)return e[0];if(t>=e[a].percentage)return e[a];for(;r<=a;){const s=Math.floor((r+a)/2);if(e[s].percentage===t)return e[s];e[s].percentage<t?r=s+1:a=s-1}return r<e.length&&a>=0?Math.abs(e[r].percentage-t)<Math.abs(e[a].percentage-t)?e[r]:e[a]:null})(F,r);a&&O({position:a.position,currentTime:a.currentTime,percentage:r})}),[F]);return(0,a.useEffect)((()=>{if(k.length>0&&T&&I){const e=k[0];e.duration=z(T,I,e.fromICAO,e.toICAO),R(e,T)}}),[T,I,k,z,R]),(0,y.jsx)("div",{className:(e?"bg-gray-900":"bg-gray-100")+" p-4 overflow-hidden",children:(0,y.jsx)("div",{className:(e?"bg-gray-800":"bg-white")+" rounded-lg shadow p-6 h-full mx-auto",children:(0,y.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-full",children:[(0,y.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure (ICAO/Name)"}),(0,y.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"EGLL"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure Time"}),(0,y.jsx)("input",{type:"datetime-local",value:T,onChange:e=>(e=>{if(S(e),!I||new Date(I)<=new Date(e)){const t=new Date(e);t.setHours(t.getHours()+1),A(t.toISOString().slice(0,16))}})(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival (ICAO/Name)"}),(0,y.jsx)("input",{type:"text",value:l,onChange:e=>u(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"KJFK"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival Time"}),(0,y.jsx)("input",{type:"datetime-local",value:I,onChange:e=>A(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,y.jsx)("button",{onClick:async()=>{if(t&&l){x(!0),C("");try{const e=await fetch(`https://api.flightplandatabase.com/search/plans?fromICAO=${t}&toICAO=${l}`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Failed to fetch flight plans");const r=await e.json();if(0===r.length)return C("No flight plans found"),M([]),void P([]);const a=r[0],s=await fetch(`https://api.flightplandatabase.com/plan/${a.id}`,{headers:{Accept:"application/json"}});if(!s.ok)throw new Error("Failed to fetch flight plan details");const n=await s.json();n.route.nodes=n.route.nodes||[],T&&I&&(n.duration=z(T,I,n.fromICAO,n.toICAO)),M([n]),R(n,T)}catch(e){C("Error fetching flight plans: "+(e instanceof Error?e.message:"Unknown error"))}finally{x(!1)}}else C("Please enter both departure and arrival")},disabled:p||!t||!l,className:"w-full bg-blue-600 text-white p-3 rounded hover:bg-blue-700 disabled:bg-blue-300 flex items-center justify-center gap-2",children:p?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(s.A,{className:"animate-spin",size:16}),"Searching..."]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.A,{size:16}),"Search Flight Plans"]})})]}),(0,y.jsxs)("div",{className:"lg:col-span-3 space-y-4",children:[N&&(0,y.jsx)("div",{className:"p-3 rounded "+(e?"bg-red-900 text-red-100":"bg-red-100 text-red-700"),children:N}),(0,y.jsx)("div",{className:"h-[calc(100vh-300px)] rounded border "+(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:(0,y.jsxs)(o.W,{style:{height:"100%",width:"100%"},center:[51.505,-.09],zoom:2,scrollWheelZoom:!0,children:[(0,y.jsx)(i.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:e?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,y.jsx)(w,{currentTime:null!==D&&void 0!==D&&D.currentTime?new Date(D.currentTime.getTime()+6e4*D.currentTime.getTimezoneOffset()):void 0}),k.map((t=>(0,y.jsxs)(a.Fragment,{children:[(0,y.jsx)(c.R,{positions:t.route.nodes.map((e=>[e.lat,e.lon])),color:e?"white":"black"}),D&&(0,y.jsx)(d.p,{position:D.position,icon:g().divIcon({html:`<div style="transform: rotate(${(()=>{const e=Math.floor(D.percentage*(t.route.nodes.length-1)/100),r=Math.min(e+1,t.route.nodes.length-1);return((e,t)=>{const r=e[0]*Math.PI/180,a=e[1]*Math.PI/180,s=t[0]*Math.PI/180,n=t[1]*Math.PI/180-a,l=Math.sin(n)*Math.cos(s),o=Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(n);let i=180*Math.atan2(l,o)/Math.PI;return i<0&&(i+=360),i})([t.route.nodes[e].lat,t.route.nodes[e].lon],[t.route.nodes[r].lat,t.route.nodes[r].lon])})()}deg)">\n                            <img src="${f.A}" alt="plane" style="width: 24px; height: 24px;" />\n                          </div>`,className:"",iconSize:[24,24],iconAnchor:[12,12]})}),t.route.nodes.length>0&&(0,y.jsx)(j,{waypoints:t.route.nodes})]},t.id)))]})}),k.length>0&&(0,y.jsxs)("div",{className:(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200")+" p-4 rounded border",children:[(0,y.jsx)("h2",{className:"text-xl font-semibold mb-4 "+(e?"text-white":"text-gray-900"),children:"Flight Plan Details"}),(0,y.jsx)("div",{className:"space-y-4",children:k.map((t=>{var r,a;return(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[t.fromICAO," \u2192 ",t.toICAO]}),(0,y.jsxs)("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:[t.fromName," \u2192 ",t.toName]}),t.duration&&(0,y.jsxs)("div",{className:"text-sm font-medium text-blue-400",children:["Duration: ",t.duration]})]}),(0,y.jsxs)("div",{className:"text-right",children:[(0,y.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(t.distance)," nm"]}),T&&(0,y.jsxs)("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Departure: ",new Date(T).toLocaleString()," -",null===(r=U(t.fromICAO))||void 0===r?void 0:r.timezone]}),I&&(0,y.jsxs)("div",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Arrival: ",new Date(I).toLocaleString()," -",null===(a=U(t.toICAO))||void 0===a?void 0:a.timezone]})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsx)("span",{className:"text-sm "+(e?"text-gray-400":"text-gray-600"),children:(null===D||void 0===D?void 0:D.currentTime.toLocaleTimeString())||"Route Progress"}),D&&(0,y.jsxs)("span",{className:"text-sm font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(D.percentage),"%"]})]}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)(m.Ay,{value:$,onChange:B,"aria-labelledby":"route-progress-slider",min:0,max:100,step:.1,disabled:!T||!F.length,sx:{"& .MuiSlider-thumb":{transition:"none",backgroundColor:e?"#fff":"#1976d2","&:hover, &.Mui-focusVisible":{backgroundColor:e?"#e0e0e0":"#1565c0"}},"& .MuiSlider-track":{transition:"none",backgroundColor:e?"#fff":"#1976d2"},"& .MuiSlider-rail":{backgroundColor:e?"#4b5563":"#e5e7eb"}}}),(0,y.jsx)("div",{className:"relative group",children:F.filter(((e,t)=>t%3===0)).map(((e,t)=>(0,y.jsxs)("div",{className:"absolute -translate-x-1/2 text-xs text-gray-400",style:{left:`${e.percentage}%`},children:["|",(0,y.jsx)("span",{className:"hidden group-hover:block absolute -translate-x-1/2 whitespace-nowrap",children:e.timeString})]},t)))})]}),D&&(0,y.jsxs)("div",{className:`text-sm ${e?"text-gray-400":"text-gray-600"} mt-4`,children:["Current Position: ",D.position[0].toFixed(2),", ",D.position[1].toFixed(2),(0,y.jsx)("br",{}),"Current Time (UTC): ",(e=>{const t=U((null===(e=k[0])||void 0===e?void 0:e.fromICAO)||"");if(!t)return D.currentTime.toLocaleString();return new Date(D.currentTime.getTime()-36e5*(t.offset.gmt+t.offset.dst)).toLocaleString()+" UTC"})()]})]})]},t.id)}))})]})]})]})})})}},809:(e,t,r)=>{r.d(t,{A:()=>a});r(43);const a=r.p+"static/media/plane-icon.5312c99550d9e701054eea554971757c.svg"}}]);
//# sourceMappingURL=52.798b1aa6.chunk.js.map