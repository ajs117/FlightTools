"use strict";(self.webpackChunkflighttools=self.webpackChunkflighttools||[]).push([[52],{395:(e,t,r)=>{r.r(t),r.d(t,{default:()=>N});var a=r(43),s=r(424),l=r(292),n=r(515),o=r(419),i=r(23),c=r(30),d=r(36),m=(r(433),r(228)),u=r.n(m),g=r(909),h=r(193),x=r(299),p=r.n(x),f=r(809),b=r(368),v=r(579);const y=r(210);delete u().Icon.Default.prototype._getIconUrl,u().Icon.Default.mergeOptions({iconRetinaUrl:r(249),iconUrl:r(24),shadowUrl:r(71)});const j=e=>{let{waypoints:t}=e;const r=(0,n.ko)();return(0,a.useEffect)((()=>{if(t.length<2)return;const e=t.map((e=>u().latLng(e.lat,e.lon))),a=u().latLngBounds(e);r.fitBounds(a,{padding:[50,50]})}),[t,r]),null},w=e=>{let{currentTime:t}=e;const r=(0,n.ko)(),s=(0,a.useRef)(null);return(0,a.useEffect)((()=>(s.current=p()().addTo(r),()=>{s.current&&r.removeLayer(s.current)})),[r]),(0,a.useEffect)((()=>{s.current&&t&&s.current.setTime(t)}),[t]),null},N=()=>{const{isDarkMode:e}=(0,b.D)(),[t,r]=(0,a.useState)((()=>localStorage.getItem("calcDeparture")||"")),[n,m]=(0,a.useState)((()=>localStorage.getItem("calcArrival")||"")),[x,p]=(0,a.useState)(!1),[N,S]=(0,a.useState)(""),[I,C]=(0,a.useState)([]),[T,A]=(0,a.useState)((()=>localStorage.getItem("calcDepartureTime")||"")),[D,k]=(0,a.useState)((()=>localStorage.getItem("calcArrivalTime")||"")),[M,O]=(0,a.useState)(null),[E,$]=(0,a.useState)(0),[F,L]=(0,a.useState)([]);(0,a.useEffect)((()=>{t?localStorage.setItem("calcDeparture",t):localStorage.removeItem("calcDeparture")}),[t]),(0,a.useEffect)((()=>{n?localStorage.setItem("calcArrival",n):localStorage.removeItem("calcArrival")}),[n]),(0,a.useEffect)((()=>{T?localStorage.setItem("calcDepartureTime",T):localStorage.removeItem("calcDepartureTime")}),[T]),(0,a.useEffect)((()=>{D?localStorage.setItem("calcArrivalTime",D):localStorage.removeItem("calcArrivalTime")}),[D]);const P=(0,a.useCallback)((e=>{try{const t=y.getAirportByIcao(e);if(null===t||void 0===t||!t.iata)return null;return g.filter((e=>e.code===t.iata))[0]||null}catch(t){return null}}),[]),U=(0,a.useCallback)(((e,t,r,a)=>{const s=P(r),l=P(a);if(!s||!l)return"Unknown duration";const n=new Date(e),o=new Date(t),i=new Date(n.getTime()-36e5*s.offset.dst),c=new Date(o.getTime()-36e5*l.offset.dst).getTime()-i.getTime();return`${Math.floor(c/36e5)}h ${Math.round(c%36e5/6e4)}m`}),[P]),z=(0,a.useCallback)(((e,t,r,a)=>{if(e.length<2)return{position:[0,0],currentTime:new Date(r),percentage:0};const s=6e5,[l,n]=a.split("h ").map((e=>parseInt(e.replace("m","")))),o=36e5*l+6e4*n;let i=t;const c=s/o*100;if(t<=c)i=0;else if(t>=100-c)i=100;else{i=(t-c)/(100-2*c)*100}const d=e.length-1,m=i*d/100,u=Math.floor(m),g=m-u;let h;if(i>=100)h=[e[d].lat,e[d].lon];else if(i<=0)h=[e[0].lat,e[0].lon];else{const t=e[u],r=e[u+1];h=[t.lat+(r.lat-t.lat)*g,t.lon+(r.lon-t.lon)*g]}const x=new Date(r),p=o*t/100;return{position:h,currentTime:new Date(x.getTime()+p),percentage:t}}),[]),R=(0,a.useCallback)(((e,t)=>{if(!e.duration||!e.route.nodes.length)return void L([]);const r=[],a=3e5,[s,l]=e.duration.split("h ").map((e=>parseInt(e.replace("m","")))),n=36e5*s+6e4*l+12e5,o=Math.ceil(n/a);for(let i=0;i<=o;i++){const s=i*a*100/n;if(s>100)break;const l=z(e.route.nodes,s,t,e.duration);r.push({...l,timeString:l.currentTime.toLocaleTimeString()})}L(r),$(0),O(r[0]||null)}),[z]),B=(0,a.useCallback)(((e,t)=>{const r="number"===typeof t?t:t[0];if($(r),0===F.length)return;const a=((e,t)=>{if(!e.length)return null;let r=0,a=e.length-1;if(t<=e[0].percentage)return e[0];if(t>=e[a].percentage)return e[a];for(;r<=a;){const s=Math.floor((r+a)/2);if(e[s].percentage===t)return e[s];e[s].percentage<t?r=s+1:a=s-1}return r<e.length&&a>=0?Math.abs(e[r].percentage-t)<Math.abs(e[a].percentage-t)?e[r]:e[a]:null})(F,r);a&&O({position:a.position,currentTime:a.currentTime,percentage:r})}),[F]);return(0,a.useEffect)((()=>{if(I.length>0&&T&&D){const e=I[0];e.duration=U(T,D,e.fromICAO,e.toICAO),R(e,T)}}),[T,D,I,U,R]),(0,v.jsx)("div",{className:(e?"bg-gray-900":"bg-gray-100")+" p-2 sm:p-4 overflow-hidden",children:(0,v.jsx)("div",{className:(e?"bg-gray-800":"bg-white")+" rounded-lg shadow p-3 sm:p-6 h-full mx-auto",children:(0,v.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3 sm:gap-6 h-full",children:[(0,v.jsxs)("div",{className:"lg:col-span-1 space-y-3 sm:space-y-4",children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure (ICAO/Name)"}),(0,v.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"EGLL"})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure Time"}),(0,v.jsx)("input",{type:"datetime-local",value:T,onChange:e=>(e=>{if(A(e),!D||new Date(D)<=new Date(e)){const t=new Date(e);t.setHours(t.getHours()+1),k(t.toISOString().slice(0,16))}})(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival (ICAO/Name)"}),(0,v.jsx)("input",{type:"text",value:n,onChange:e=>m(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"KJFK"})]}),(0,v.jsxs)("div",{children:[(0,v.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival Time"}),(0,v.jsx)("input",{type:"datetime-local",value:D,onChange:e=>k(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,v.jsx)("button",{onClick:async()=>{if(t&&n){p(!0),S("");try{const e=await fetch(`https://api.flightplandatabase.com/search/plans?fromICAO=${t}&toICAO=${n}`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Failed to fetch flight plans");const r=await e.json();if(0===r.length)return S("No flight plans found"),C([]),void L([]);const a=r[0],s=await fetch(`https://api.flightplandatabase.com/plan/${a.id}`,{headers:{Accept:"application/json"}});if(!s.ok)throw new Error("Failed to fetch flight plan details");const l=await s.json();l.route.nodes=l.route.nodes||[],T&&D&&(l.duration=U(T,D,l.fromICAO,l.toICAO)),C([l]),R(l,T)}catch(e){S("Error fetching flight plans: "+(e instanceof Error?e.message:"Unknown error"))}finally{p(!1)}}else S("Please enter both departure and arrival")},disabled:x||!t||!n,className:"w-full bg-blue-600 text-white p-2 sm:p-3 rounded hover:bg-blue-700 disabled:bg-blue-300 flex items-center justify-center gap-2 text-sm sm:text-base",children:x?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(s.A,{className:"animate-spin",size:16}),"Searching..."]}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(l.A,{size:16}),"Search Flight Plans"]})}),(0,v.jsx)("button",{onClick:()=>{r(""),m(""),A(""),k(""),C([]),O(null),$(0),L([]),S(""),localStorage.removeItem("calcDeparture"),localStorage.removeItem("calcArrival"),localStorage.removeItem("calcDepartureTime"),localStorage.removeItem("calcArrivalTime")},className:"w-full bg-red-600 text-white p-2 sm:p-3 rounded hover:bg-red-700 flex items-center justify-center gap-2 text-sm sm:text-base",children:"Clear All Fields"})]}),(0,v.jsxs)("div",{className:"lg:col-span-3 space-y-3 sm:space-y-4",children:[N&&(0,v.jsx)("div",{className:"p-2 sm:p-3 rounded text-sm sm:text-base "+(e?"bg-red-900 text-red-100":"bg-red-100 text-red-700"),children:N}),(0,v.jsx)("div",{className:"h-[50vh] md:h-[calc(100vh-350px)] rounded border "+(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:(0,v.jsxs)(o.W,{style:{height:"100%",width:"100%"},center:[51.505,-.09],zoom:2,scrollWheelZoom:!0,children:[(0,v.jsx)(i.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:e?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,v.jsx)(w,{currentTime:null!==M&&void 0!==M&&M.currentTime?new Date(M.currentTime.getTime()+6e4*M.currentTime.getTimezoneOffset()):void 0}),I.map((e=>(0,v.jsxs)(a.Fragment,{children:[(0,v.jsx)(c.R,{positions:e.route.nodes.map((e=>[e.lat,e.lon])),color:"red"}),M&&(0,v.jsx)(d.p,{position:M.position,icon:u().divIcon({html:`<div style="transform: rotate(${(()=>{const t=Math.floor(M.percentage*(e.route.nodes.length-1)/100),r=Math.min(t+1,e.route.nodes.length-1);return((e,t)=>{const r=e[0]*Math.PI/180,a=e[1]*Math.PI/180,s=t[0]*Math.PI/180,l=t[1]*Math.PI/180-a,n=Math.sin(l)*Math.cos(s),o=Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(l);let i=180*Math.atan2(n,o)/Math.PI;return i<0&&(i+=360),i})([e.route.nodes[t].lat,e.route.nodes[t].lon],[e.route.nodes[r].lat,e.route.nodes[r].lon])})()}deg)">\n                            <img src="${f.A}" alt="plane" style="width: 24px; height: 24px;" />\n                          </div>`,className:"",iconSize:[24,24],iconAnchor:[12,12]})}),e.route.nodes.length>0&&(0,v.jsx)(j,{waypoints:e.route.nodes})]},e.id)))]})}),I.length>0&&(0,v.jsxs)("div",{className:(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200")+" p-3 sm:p-4 rounded border text-sm sm:text-base",children:[(0,v.jsx)("h2",{className:"text-lg sm:text-xl font-semibold mb-2 sm:mb-4 "+(e?"text-white":"text-gray-900"),children:"Flight Plan Details"}),(0,v.jsx)("div",{className:"space-y-3 sm:space-y-4",children:I.map((t=>{var r,a;return(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-2 sm:mb-4",children:[(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[t.fromICAO," \u2192 ",t.toICAO]}),(0,v.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:[t.fromName," \u2192 ",t.toName]}),t.duration&&(0,v.jsxs)("div",{className:"text-xs sm:text-sm font-medium text-blue-400",children:["Duration: ",t.duration]})]}),(0,v.jsxs)("div",{className:"text-right",children:[(0,v.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(t.distance)," nm"]}),T&&(0,v.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Departure: ",new Date(T).toLocaleString()," -",null===(r=P(t.fromICAO))||void 0===r?void 0:r.timezone]}),D&&(0,v.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Arrival: ",new Date(D).toLocaleString()," -",null===(a=P(t.toICAO))||void 0===a?void 0:a.timezone]})]})]}),(0,v.jsxs)("div",{children:[(0,v.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,v.jsx)("span",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:(null===M||void 0===M?void 0:M.currentTime.toLocaleTimeString())||"Route Progress"}),M&&(0,v.jsxs)("span",{className:"text-xs sm:text-sm font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(M.percentage),"%"]})]}),(0,v.jsxs)("div",{className:"relative",children:[(0,v.jsx)(h.Ay,{value:E,onChange:B,"aria-labelledby":"route-progress-slider",min:0,max:100,step:.1,disabled:!T||!F.length,sx:{"& .MuiSlider-thumb":{transition:"none",backgroundColor:e?"#fff":"#1976d2","&:hover, &.Mui-focusVisible":{backgroundColor:e?"#e0e0e0":"#1565c0"}},"& .MuiSlider-track":{transition:"none",backgroundColor:e?"#fff":"#1976d2"},"& .MuiSlider-rail":{backgroundColor:e?"#4b5563":"#e5e7eb"}}}),(0,v.jsx)("div",{className:"relative group",children:F.filter(((e,t)=>t%3===0)).map(((e,t)=>(0,v.jsxs)("div",{className:"absolute -translate-x-1/2 text-xs text-gray-400",style:{left:`${e.percentage}%`},children:["|",(0,v.jsx)("span",{className:"hidden group-hover:block absolute -translate-x-1/2 whitespace-nowrap text-[10px] sm:text-xs",children:e.timeString})]},t)))})]}),M&&(0,v.jsxs)("div",{className:`text-xs sm:text-sm ${e?"text-gray-400":"text-gray-600"} mt-4 sm:mt-4`,children:["Current Position: ",M.position[0].toFixed(2),", ",M.position[1].toFixed(2),(0,v.jsx)("br",{}),"Current Time (UTC): ",(e=>{const t=P((null===(e=I[0])||void 0===e?void 0:e.fromICAO)||"");if(!t)return M.currentTime.toLocaleString();return new Date(M.currentTime.getTime()-36e5*(t.offset.gmt+t.offset.dst)).toLocaleString()+" UTC"})()]})]})]},t.id)}))})]})]})]})})})}},809:(e,t,r)=>{r.d(t,{A:()=>a});r(43);const a=r.p+"static/media/plane-icon.5312c99550d9e701054eea554971757c.svg"}}]);
//# sourceMappingURL=52.4b1b53d4.chunk.js.map