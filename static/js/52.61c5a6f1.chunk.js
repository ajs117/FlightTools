"use strict";(self.webpackChunkflighttools=self.webpackChunkflighttools||[]).push([[52],{395:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var r=s(43),a=s(424),n=s(292),l=s(515),o=s(419),i=s(23),c=s(30),d=s(36),u=(s(433),s(228)),m=s.n(u),g=s(909),h=s(193),x=s(299),p=s.n(x),f=s(809),b=s(368),y=s(579);const v=s(210);delete m().Icon.Default.prototype._getIconUrl,m().Icon.Default.mergeOptions({iconRetinaUrl:s(249),iconUrl:s(24),shadowUrl:s(71)});const j=e=>{let{waypoints:t}=e;const s=(0,l.ko)();return(0,r.useEffect)((()=>{if(t.length<2)return;const e=t.map((e=>m().latLng(e.lat,e.lon))),r=m().latLngBounds(e);s.fitBounds(r,{padding:[50,50]})}),[t,s]),null},w=e=>{let{currentTime:t}=e;const s=(0,l.ko)(),a=(0,r.useRef)(null);return(0,r.useEffect)((()=>(a.current=p()().addTo(s),()=>{a.current&&s.removeLayer(a.current)})),[s]),(0,r.useEffect)((()=>{a.current&&t&&a.current.setTime(t)}),[t]),null},N=()=>{const{isDarkMode:e}=(0,b.D)(),[t,s]=(0,r.useState)(""),[l,u]=(0,r.useState)(""),[x,p]=(0,r.useState)(!1),[N,C]=(0,r.useState)(""),[k,M]=(0,r.useState)([]),[T,S]=(0,r.useState)(""),[I,A]=(0,r.useState)(""),[D,O]=(0,r.useState)(null),[$,L]=(0,r.useState)(0),[F,P]=(0,r.useState)([]),U=(0,r.useCallback)((e=>{try{const t=v.getAirportByIcao(e);if(null===t||void 0===t||!t.iata)return null;return g.filter((e=>e.code===t.iata))[0]||null}catch(t){return null}}),[]),z=(0,r.useCallback)(((e,t,s,r)=>{const a=U(s),n=U(r);if(!a||!n)return"Unknown duration";const l=new Date(e),o=new Date(t),i=new Date(l.getTime()-36e5*a.offset.dst),c=new Date(o.getTime()-36e5*n.offset.dst).getTime()-i.getTime();return`${Math.floor(c/36e5)}h ${Math.round(c%36e5/6e4)}m`}),[U]),E=(0,r.useCallback)(((e,t,s,r)=>{if(e.length<2)return{position:[0,0],currentTime:new Date(s),percentage:0};const a=6e5,[n,l]=r.split("h ").map((e=>parseInt(e.replace("m","")))),o=36e5*n+6e4*l;let i=t;const c=a/o*100;if(t<=c)i=0;else if(t>=100-c)i=100;else{i=(t-c)/(100-2*c)*100}const d=e.length-1,u=i*d/100,m=Math.floor(u),g=u-m;let h;if(i>=100)h=[e[d].lat,e[d].lon];else if(i<=0)h=[e[0].lat,e[0].lon];else{const t=e[m],s=e[m+1];h=[t.lat+(s.lat-t.lat)*g,t.lon+(s.lon-t.lon)*g]}const x=new Date(s),p=o*t/100;return{position:h,currentTime:new Date(x.getTime()+p),percentage:t}}),[]),R=(0,r.useCallback)(((e,t)=>{if(!e.duration||!e.route.nodes.length)return void P([]);const s=[],r=3e5,[a,n]=e.duration.split("h ").map((e=>parseInt(e.replace("m","")))),l=36e5*a+6e4*n+12e5,o=Math.ceil(l/r);for(let i=0;i<=o;i++){const a=i*r*100/l;if(a>100)break;const n=E(e.route.nodes,a,t,e.duration);s.push({...n,timeString:n.currentTime.toLocaleTimeString()})}P(s),L(0),O(s[0]||null)}),[E]),B=(0,r.useCallback)(((e,t)=>{const s="number"===typeof t?t:t[0];if(L(s),0===F.length)return;const r=((e,t)=>{if(!e.length)return null;let s=0,r=e.length-1;if(t<=e[0].percentage)return e[0];if(t>=e[r].percentage)return e[r];for(;s<=r;){const a=Math.floor((s+r)/2);if(e[a].percentage===t)return e[a];e[a].percentage<t?s=a+1:r=a-1}return s<e.length&&r>=0?Math.abs(e[s].percentage-t)<Math.abs(e[r].percentage-t)?e[s]:e[r]:null})(F,s);r&&O({position:r.position,currentTime:r.currentTime,percentage:s})}),[F]);return(0,r.useEffect)((()=>{if(k.length>0&&T&&I){const e=k[0];e.duration=z(T,I,e.fromICAO,e.toICAO),R(e,T)}}),[T,I,k,z,R]),(0,y.jsx)("div",{className:(e?"bg-gray-900":"bg-gray-100")+" p-2 sm:p-4 overflow-hidden",children:(0,y.jsx)("div",{className:(e?"bg-gray-800":"bg-white")+" rounded-lg shadow p-3 sm:p-6 h-full mx-auto",children:(0,y.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3 sm:gap-6 h-full",children:[(0,y.jsxs)("div",{className:"lg:col-span-1 space-y-3 sm:space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure (ICAO/Name)"}),(0,y.jsx)("input",{type:"text",value:t,onChange:e=>s(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"EGLL"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Departure Time"}),(0,y.jsx)("input",{type:"datetime-local",value:T,onChange:e=>(e=>{if(S(e),!I||new Date(I)<=new Date(e)){const t=new Date(e);t.setHours(t.getHours()+1),A(t.toISOString().slice(0,16))}})(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival (ICAO/Name)"}),(0,y.jsx)("input",{type:"text",value:l,onChange:e=>u(e.target.value.toUpperCase()),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900"),placeholder:"KJFK"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:`block text-xs sm:text-sm font-medium ${e?"text-gray-300":"text-gray-700"} mb-1`,children:"Arrival Time"}),(0,y.jsx)("input",{type:"datetime-local",value:I,onChange:e=>A(e.target.value),className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(e?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900")})]}),(0,y.jsx)("button",{onClick:async()=>{if(t&&l){p(!0),C("");try{const e=await fetch(`https://api.flightplandatabase.com/search/plans?fromICAO=${t}&toICAO=${l}`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Failed to fetch flight plans");const s=await e.json();if(0===s.length)return C("No flight plans found"),M([]),void P([]);const r=s[0],a=await fetch(`https://api.flightplandatabase.com/plan/${r.id}`,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error("Failed to fetch flight plan details");const n=await a.json();n.route.nodes=n.route.nodes||[],T&&I&&(n.duration=z(T,I,n.fromICAO,n.toICAO)),M([n]),R(n,T)}catch(e){C("Error fetching flight plans: "+(e instanceof Error?e.message:"Unknown error"))}finally{p(!1)}}else C("Please enter both departure and arrival")},disabled:x||!t||!l,className:"w-full bg-blue-600 text-white p-2 sm:p-3 rounded hover:bg-blue-700 disabled:bg-blue-300 flex items-center justify-center gap-2 text-sm sm:text-base",children:x?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.A,{className:"animate-spin",size:16}),"Searching..."]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.A,{size:16}),"Search Flight Plans"]})})]}),(0,y.jsxs)("div",{className:"lg:col-span-3 space-y-3 sm:space-y-4",children:[N&&(0,y.jsx)("div",{className:"p-2 sm:p-3 rounded text-sm sm:text-base "+(e?"bg-red-900 text-red-100":"bg-red-100 text-red-700"),children:N}),(0,y.jsx)("div",{className:"h-[50vh] md:h-[calc(100vh-350px)] rounded border "+(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"),children:(0,y.jsxs)(o.W,{style:{height:"100%",width:"100%"},center:[51.505,-.09],zoom:2,scrollWheelZoom:!0,children:[(0,y.jsx)(i.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:e?"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,y.jsx)(w,{currentTime:null!==D&&void 0!==D&&D.currentTime?new Date(D.currentTime.getTime()+6e4*D.currentTime.getTimezoneOffset()):void 0}),k.map((t=>(0,y.jsxs)(r.Fragment,{children:[(0,y.jsx)(c.R,{positions:t.route.nodes.map((e=>[e.lat,e.lon])),color:e?"white":"black"}),D&&(0,y.jsx)(d.p,{position:D.position,icon:m().divIcon({html:`<div style="transform: rotate(${(()=>{const e=Math.floor(D.percentage*(t.route.nodes.length-1)/100),s=Math.min(e+1,t.route.nodes.length-1);return((e,t)=>{const s=e[0]*Math.PI/180,r=e[1]*Math.PI/180,a=t[0]*Math.PI/180,n=t[1]*Math.PI/180-r,l=Math.sin(n)*Math.cos(a),o=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(n);let i=180*Math.atan2(l,o)/Math.PI;return i<0&&(i+=360),i})([t.route.nodes[e].lat,t.route.nodes[e].lon],[t.route.nodes[s].lat,t.route.nodes[s].lon])})()}deg)">\n                            <img src="${f.A}" alt="plane" style="width: 24px; height: 24px;" />\n                          </div>`,className:"",iconSize:[24,24],iconAnchor:[12,12]})}),t.route.nodes.length>0&&(0,y.jsx)(j,{waypoints:t.route.nodes})]},t.id)))]})}),k.length>0&&(0,y.jsxs)("div",{className:(e?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200")+" p-3 sm:p-4 rounded border text-sm sm:text-base",children:[(0,y.jsx)("h2",{className:"text-lg sm:text-xl font-semibold mb-2 sm:mb-4 "+(e?"text-white":"text-gray-900"),children:"Flight Plan Details"}),(0,y.jsx)("div",{className:"space-y-3 sm:space-y-4",children:k.map((t=>{var s,r;return(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-2 sm:mb-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[t.fromICAO," \u2192 ",t.toICAO]}),(0,y.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:[t.fromName," \u2192 ",t.toName]}),t.duration&&(0,y.jsxs)("div",{className:"text-xs sm:text-sm font-medium text-blue-400",children:["Duration: ",t.duration]})]}),(0,y.jsxs)("div",{className:"text-right",children:[(0,y.jsxs)("div",{className:"font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(t.distance)," nm"]}),T&&(0,y.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Departure: ",new Date(T).toLocaleString()," -",null===(s=U(t.fromICAO))||void 0===s?void 0:s.timezone]}),I&&(0,y.jsxs)("div",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:["Arrival: ",new Date(I).toLocaleString()," -",null===(r=U(t.toICAO))||void 0===r?void 0:r.timezone]})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-1 sm:mb-2",children:[(0,y.jsx)("span",{className:"text-xs sm:text-sm "+(e?"text-gray-400":"text-gray-600"),children:(null===D||void 0===D?void 0:D.currentTime.toLocaleTimeString())||"Route Progress"}),D&&(0,y.jsxs)("span",{className:"text-xs sm:text-sm font-medium "+(e?"text-white":"text-gray-900"),children:[Math.round(D.percentage),"%"]})]}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)(h.Ay,{value:$,onChange:B,"aria-labelledby":"route-progress-slider",min:0,max:100,step:.1,disabled:!T||!F.length,sx:{"& .MuiSlider-thumb":{transition:"none",backgroundColor:e?"#fff":"#1976d2","&:hover, &.Mui-focusVisible":{backgroundColor:e?"#e0e0e0":"#1565c0"}},"& .MuiSlider-track":{transition:"none",backgroundColor:e?"#fff":"#1976d2"},"& .MuiSlider-rail":{backgroundColor:e?"#4b5563":"#e5e7eb"}}}),(0,y.jsx)("div",{className:"relative group",children:F.filter(((e,t)=>t%3===0)).map(((e,t)=>(0,y.jsxs)("div",{className:"absolute -translate-x-1/2 text-xs text-gray-400",style:{left:`${e.percentage}%`},children:["|",(0,y.jsx)("span",{className:"hidden group-hover:block absolute -translate-x-1/2 whitespace-nowrap text-[10px] sm:text-xs",children:e.timeString})]},t)))})]}),D&&(0,y.jsxs)("div",{className:`text-xs sm:text-sm ${e?"text-gray-400":"text-gray-600"} mt-2 sm:mt-4`,children:["Current Position: ",D.position[0].toFixed(2),", ",D.position[1].toFixed(2),(0,y.jsx)("br",{}),"Current Time (UTC): ",(e=>{const t=U((null===(e=k[0])||void 0===e?void 0:e.fromICAO)||"");if(!t)return D.currentTime.toLocaleString();return new Date(D.currentTime.getTime()-36e5*(t.offset.gmt+t.offset.dst)).toLocaleString()+" UTC"})()]})]})]},t.id)}))})]})]})]})})})}},809:(e,t,s)=>{s.d(t,{A:()=>r});s(43);const r=s.p+"static/media/plane-icon.5312c99550d9e701054eea554971757c.svg"}}]);
//# sourceMappingURL=52.61c5a6f1.chunk.js.map